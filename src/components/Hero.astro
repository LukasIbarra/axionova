---
import EmblaCarousel from 'embla-carousel';
import Autoplay from 'embla-carousel-autoplay';

interface FormField {
  type: "text" | "email" | "tel";
  placeholder: string;
  required: boolean;
}

declare global {
  interface Window {
    EmblaCarousel: any;
  }
}

const heroSlides = [
  {
    type: "text",
    src: "/conte3.jpg",
    alt: "Minería moderna y confiable",
    title: "Soluciones Mineras <span class='gradient-text-orange'>Innovadoras</span> para el Futuro",
    subtitle: "Tecnología de punta que transforma la industria minera con eficiencia y seguridad incomparables",
    cta: [
      { text: "Descubrir Servicios", href: "#servicios", variant: "primary" },
      { text: "Contactar Expertos", href: "#contacto", variant: "secondary" }
    ]
  },
  {
    type: "features",
    src: "/conte4.jpg", 
    alt: "Nuestros valores",
    title: "Comprometidos con la <span class='gradient-text-green'>Excelencia</span>",
    subtitle: "En cada proyecto entregamos lo mejor de nosotros",
    features: [
      { icon: "clock", title: "Puntualidad", description: "Entregas a tiempo siempre" },
      { icon: "shield", title: "Seguridad", description: "Protocolos de máximo nivel" },
      { icon: "chart", title: "Eficiencia", description: "Optimización de procesos" },
      { icon: "diamond", title: "Calidad", description: "Resultados premium garantizados" }
    ]
  },
  {
    type: "form",
    src: "/conte5.jpg",
    alt: "Contacto",
    title: "¿Listo para <span class='gradient-text-orange'>Transformar</span> su Operación?",
    subtitle: "Hablemos sobre su proyecto - Nuestros expertos le contactarán en 24h",
    formFields: [
      { type: "text" as const, placeholder: "Nombre completo", required: true },
      { type: "email" as const, placeholder: "Correo electrónico", required: true },
      { type: "tel" as const, placeholder: "Teléfono", required: false }
    ] as FormField[]
  },
  {
    type: "stats",
    src: "/conte6.jpg",
    alt: "Resultados comprobados",
    title: "Resultados que <span class='gradient-text-orange'>Impactan</span>",
    subtitle: "Llevamos más de una década optimizando operaciones mineras",
    stats: [
      { value: "98%", label: "Satisfacción clientes" },
      { value: "45%", label: "Aumento eficiencia" },
      { value: "200+", label: "Proyectos exitosos" },
      { value: "0", label: "Incidentes graves" }
    ]
  }
];
---

<section class="relative h-screen w-full overflow-hidden text-white">
  <!-- Embla Carousel -->
  <div class="embla h-full w-full">
    <div class="embla__container flex h-full">
      {heroSlides.map((slide) => (
        <div class="embla__slide flex-shrink-0 w-full h-full relative">
          <img 
            src={slide.src} 
            alt={slide.alt} 
            class="absolute inset-0 w-full h-full object-cover scale-110 transition-transform duration-1000 embla__slide__img" 
          />
          <div class="absolute inset-0 bg-gradient-to-r from-axionova-dark/85 via-axionova-dark/60 to-transparent"></div>
        </div>
      ))}
    </div>
  </div>

  <!-- Contenido Overlay -->
  <div class="absolute inset-0 z-10 flex items-center px-6 md:px-12 lg:px-24 bg-black/50">
    {heroSlides.map((slide, index) => (
      <div class="hero-content absolute w-full max-w-6xl transition-all duration-1000 transform translate-y-8 opacity-0" data-index={index}>
        
        <!-- Slide tipo texto -->
        {slide.type === "text" && (
          <div class="max-w-2xl">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight" set:html={slide.title}></h1>
            <p class="text-xl md:text-2xl text-gradient-green mb-8 max-w-3xl">{slide.subtitle}</p>
            <div class="flex flex-wrap gap-4">
              {slide.cta && slide.cta.map(button => (
                <a href={button.href} class={`px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2 group ${
                  button.variant === "primary" 
                    ? 'bg-gradient-to-r from-axionova-orange to-orange-600 text-white' 
                    : 'bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20'
                }`}>
                  <span>{button.text}</span>
                  <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </a>
              ))}
            </div>
          </div>
        )}
        
        <!-- Slide tipo características -->
        {slide.type === "features" && (
          <div class="w-full">
            <div class="max-w-2xl mb-12">
              <div class="flex justify-start mb-6">
                <span class="inline-flex items-center px-4 py-2 rounded-full bg-gradient-to-r from-axionova-orange/20 to-orange-600/20 border border-axionova-orange/30 text-axionova-orange text-sm font-medium">
                  <i class="fas fa-crown mr-2"></i>
                  Líderes en innovación
                </span>
              </div>
              <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4 leading-tight text-gradient-green" set:html={slide.title}></h1>
              <p class="text-xl text-gradient-green">{slide.subtitle}</p>
            </div>
            <div class="flex flex-wrap justify-start items-center gap-8 mt-8">
              <div class="flex items-center text-lg text-gray-200">
                <i class="fas fa-shield-alt text-axionova-green mr-3 text-xl"></i>
                <span>99.9% <span class="text-gradient-green font-semibold">seguridad</span></span>
              </div>
              <div class="flex items-center text-lg text-gray-200">
                <i class="fas fa-chart-line text-axionova-orange mr-3 text-xl"></i>
                <span>100% <span class="text-gradient-orange font-semibold">eficacia</span></span>
              </div>
              <div class="flex items-center text-lg text-gray-200">
                <i class="fas fa-clock text-axionova-green mr-3 text-xl"></i>
                <span>98% <span class="text-gradient-green font-semibold">puntualidad</span></span>
              </div>
              <div class="flex items-center text-lg text-gray-200">
                <i class="fas fa-gem text-axionova-orange mr-3 text-xl"></i>
                <span>Premium <span class="text-gradient-orange font-semibold">calidad</span></span>
              </div>
            </div>
          </div>
        )}
        
        <!-- Slide tipo formulario -->
        {slide.type === "form" && (
          <div class="flex flex-col md:flex-row gap-12 w-full items-center">
            <div class="flex-1 max-w-2xl">
              <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight text-gradient-green" set:html={slide.title}></h1>
              <p class="text-xl text-gradient-green mb-8">{slide.subtitle}</p>
            </div>
            <div class="flex-1 bg-white/10 backdrop-blur-md p-8 rounded-2xl border border-white/20 max-w-md">
              <form class="space-y-5">
                {slide.formFields?.map(field => (
                  <input
                    type={field.type}
                    placeholder={field.placeholder}
                    required={field.required}
                    class="w-full px-5 py-3 bg-white/5 border border-white/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-axionova-orange"
                  />
                ))}
                <button type="submit" class="w-full bg-gradient-to-r from-axionova-orange to-orange-600 py-4 rounded-xl font-bold text-lg mt-2 hover:scale-[1.02] transition-transform">
                  Solicitar Asesoría
                </button>
              </form>
            </div>
          </div>
        )}
        
        <!-- Slide tipo estadísticas -->
        {slide.type === "stats" && (
          <div class="w-full">
            <div class="max-w-2xl mb-16">
              <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight text-gradient-green" set:html={slide.title}></h1>
              <p class="text-xl text-gradient-green">{slide.subtitle}</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
              {slide.stats?.map(stat => (
                <div class="text-center">
                  <div class="text-5xl md:text-6xl font-bold mb-2 gradient-text-orange">{stat.value}</div>
                  <div class="text-gray-200 uppercase text-sm tracking-wider">{stat.label}</div>
                </div>
              ))}
            </div>
            <div class="mt-12">
              <a href="#contacto" class="inline-flex items-center px-8 py-4 rounded-xl font-bold text-lg bg-gradient-to-r from-axionova-green to-green-600 group">
                <span>Ver casos de éxito</span>
                <svg class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
              </a>
            </div>
          </div>
        )}
        
      </div>
    ))}
  </div>

  <!-- Navegación -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 flex items-center">
    <!-- Flechas -->
    <button class="embla-prev mr-4 bg-white/10 hover:bg-axionova-orange p-3 rounded-full transition-all duration-300 flex items-center justify-center">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    
    <!-- Dots personalizados -->
    <div class="flex space-x-3">
      {heroSlides.map((_, index) => (
        <button class="embla-dot w-3 h-3 rounded-full bg-white/30 transition-all duration-300 relative group" data-index={index}>
          <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 text-xs font-medium bg-black/70 px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">
            {index + 1}
          </span>
        </button>
      ))}
    </div>
    
    <button class="embla-next ml-4 bg-white/10 hover:bg-axionova-orange p-3 rounded-full transition-all duration-300 flex items-center justify-center">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</section>

<style>
  :global(:root) {
    --axionova-orange: #FF7A00;
    --axionova-orange-light: #FF9A40;
    --axionova-green: #00C853;
    --axionova-green-light: #00E676;
    --axionova-dark: #1A2B3C;
  }

  .embla { 
    overflow: hidden; 
  }
  
  .embla__container { 
    display: flex; 
    will-change: transform;
  }
  
  .embla__slide { 
    flex: 0 0 100%; 
    position: relative; 
  }

  .embla__slide__img {
    transform: scale(1.15);
    transition: transform 12s ease-out;
  }

  .embla__slide.is-selected .embla__slide__img {
    transform: scale(1);
  }

  .gradient-text-orange {
    background: linear-gradient(135deg, var(--axionova-orange), var(--axionova-orange-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }



  .embla-dot.is-selected {
    background: linear-gradient(135deg, var(--axionova-orange), var(--axionova-orange-light));
    transform: scale(1.4);
  }

  /* Animaciones de entrada para el contenido */
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .hero-content.active {
    animation: slideInUp 0.8s ease-out forwards;
  }
</style>

<!-- Embla Carousel CDN -->
<script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializar carousel
    const emblaNode = document.querySelector('.embla');
    const embla = window.EmblaCarousel(emblaNode, { 
      loop: true,
      duration: 25
    });
    
    const contents = document.querySelectorAll('.hero-content');
    const dots = document.querySelectorAll('.embla-dot');
    const prevBtn = document.querySelector('.embla-prev');
    const nextBtn = document.querySelector('.embla-next');
    
    // Actualizar slide activo
    const updateActiveSlide = () => {
      const index = embla.selectedScrollSnap();
  
      // Ocultar todos los contenidos
      contents.forEach(content => {
        (content as HTMLElement).style.opacity = '0';
        (content as HTMLElement).style.transform = 'translateY(30px)';
      });
  
      // Actualizar dots
      dots.forEach(dot => dot.classList.remove('is-selected'));
  
      // Mostrar contenido activo
      if (contents[index]) {
        (contents[index] as HTMLElement).style.opacity = '1';
        (contents[index] as HTMLElement).style.transform = 'translateY(0)';
      }
  
      // Activar dot correspondiente
      if (dots[index]) {
        dots[index].classList.add('is-selected');
      }
    };
    
    // Event listeners
    embla.on('select', updateActiveSlide);
    
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => embla.scrollTo(index));
    });
  
    if (prevBtn) {
      prevBtn.addEventListener('click', () => embla.scrollPrev());
    }
    if (nextBtn) {
      nextBtn.addEventListener('click', () => embla.scrollNext());
    }
    
    // Actualizar slide activo al iniciar
    updateActiveSlide();
    
    // Autoplay
    setInterval(() => {
      embla.scrollNext();
    }, 7000);
  });
  </script>
