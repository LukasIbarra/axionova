---
interface Metric { value: string; label: string; color?: string; }
interface Slide {
  id: number;
  eyebrow?: string;
  eyebrowClass?: string;
  title1: string;
  title2: string;
  desc: string;
  img: string;
  ctaText?: string;
  ctaHref?: string;
  align?: "center" | "left" | "right";
  metrics?: Metric[];
}

const slides: Slide[] = [
  {
    id: 1,
    eyebrow: "Líder en Innovación Minera 2024",
    eyebrowClass:
      "text-emerald-400 font-medium bg-emerald-500/10 border border-emerald-500/20 animate-fade-in",
    title1: "El futuro de la",
    title2: "minería es HOY",
    desc:
      "Revolucionamos la industria con tecnologia de vanguardia que maximiza la eficiencia, garantía la seguridad y protege el medio ambiente.",
    img: "./servi4.jpg",
    ctaText: "Cotizar",
    ctaHref: "#contacto",
    align: "center",
  },
  {
    id: 2,
    eyebrow: "Líderes de la industria",
    eyebrowClass:
      "text-orange-400 font-medium bg-orange-500/10 border border-orange-500/20 animate-fade-in",
    title1: "Resultados que",
    title2: "hablan por sí mismos",
    desc:
      "Más de 15 años liderando la transformación digital de la minería con resultados comprobados y reconocimiento mundial.",
    img: "./conte.jpg",
    ctaText: "Solicitar Consultoría",
    ctaHref: "#consulta",
    align: "left",
    metrics: [
      { value: "300%",  label: "Aumento Eficiencia",  color: "bg-orange-500/20" },
      { value: "99.9%", label: "Índice Seguridad",    color: "bg-emerald-500/20" },
      { value: "50+",   label: "Proyectos Exitosos",  color: "bg-blue-500/20" },
      { value: "12",    label: "Países Activos",      color: "bg-emerald-500/20" },
    ],
  },
  {
    id: 3,
    eyebrow: "Consultoría Gratuita",
    eyebrowClass:
      "text-emerald-400 font-medium bg-emerald-500/10 border border-emerald-500/20 animate-fade-in",
    title1: "¿Listo para",
    title2: "Transformar tu Operación?",
    desc:
      "Obtén una consultoría gratuita y descubre cómo nuestras soluciones pueden revolucionar tu empresa minera.",
    img: "./conte4.jpg",
    ctaText: "Solicitar Consultoría",
    ctaHref: "#consulta",
    align: "right",
  },
];
---

<section
  id="hero"
  class="relative overflow-hidden isolate"
  style="height: 100vh;"
  aria-label="Carrusel principal"
>
  {slides.map((s, i) => (
    <article
      class={`hero-slide absolute inset-0 transition-opacity duration-700 ease-in-out ${i === 0 ? "is-active" : ""}`}
      data-index={i}
      role="group"
      aria-roledescription="slide"
      aria-label={`${i + 1} de ${slides.length}`}
    >
      <!-- Imagen de fondo por slide (no bloquea clics) -->
      <img
        src={s.img}
        alt={s.title1 + " " + s.title2}
        class="hero-image pointer-events-none absolute inset-0 w-full h-full object-cover"
        loading={i === 0 ? "eager" : "lazy"}
      />
      

      <!-- Overlay oscuro (no bloquea clics) -->
      <div class="hero-backdrop pointer-events-none absolute inset-0 bg-black/60"></div>

      <!-- Contenido con alineación específica por slide -->
      {(() => {
        const isLeft  = s.align === "left";
        const isRight = s.align === "right";
        const padEdge = isLeft ? "lg:pl-28" : isRight ? "lg:pr-28" : ""; // despega de botones laterales

        return (
          <div class={`relative z-20 flex h-full items-center justify-center px-6 md:px-10 ${padEdge}`}>
            <div class={`flex w-full items-center gap-8 lg:gap-12
                          ${isLeft ? "lg:justify-start" : isRight ? "lg:justify-end" : "lg:justify-center"}`}>

              <!-- Bloque de texto -->
              <div class={`max-w-3xl text-white space-y-6 mx-auto
                          text-center ${isLeft ? "lg:text-left lg:mx-0" : ""} ${isRight ? "lg:text-right lg:mx-0" : ""}`}>
                {s.eyebrow && (
                    <span class={`inline-block px-4 py-2 rounded-full text-sm ${s.eyebrowClass ?? ""}`}>
                        {s.eyebrow}
                    </span>
                )}

                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight">
                  {s.title1}{" "}
                  <span class="bg-gradient-to-r from-orange-500 to-orange-400 bg-clip-text text-transparent">
                    {s.title2}
                  </span>
                </h1>

                <p class="text-lg sm:text-xl text-white/90">{s.desc}</p>

                <div class={`flex flex-wrap gap-4
                            justify-center ${isLeft ? "lg:justify-start" : ""} ${isRight ? "lg:justify-end" : ""}`}>
                  {s.ctaText && (
                    <>
                      <a
                        href={s.ctaHref ?? "#"}
                        class="px-6 py-3 rounded-xl font-semibold bg-orange-500 hover:bg-orange-600 text-white shadow-lg transition"
                      >
                        {s.ctaText}
                      </a>
                      <a
                        href="#servicios"
                        class="px-6 py-3 rounded-xl font-semibold border border-white/40 text-white hover:bg-white/10 transition"
                      >
                        Explorar Servicios
                      </a>
                    </>
                  )}
                </div>
              </div>

              <!-- Panel de métricas (solo slide 2, Desktop) -->
              {s.metrics && (
                <aside class="hidden lg:block">
                  <div class="grid grid-cols-2 gap-4">
                    {s.metrics.map((m) => (
                      <div class={`min-w-[210px] rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md
                                   px-5 py-4 text-white shadow-md`}>
                        <div class={`inline-flex h-8 w-8 items-center justify-center rounded-md ${m.color ?? "bg-white/10"}`}></div>
                        <div class="mt-2 text-3xl font-extrabold leading-none">{m.value}</div>
                        <div class="mt-1 text-sm text-white/80">{m.label}</div>
                      </div>
                    ))}
                  </div>
                </aside>
              )}

            </div>
          </div>
        );
      })()}
    </article>
  ))}

  <!-- Controles -->
  <button id="hero-prev"
    class="hero-controls pointer-events-auto z-30 absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 hover:bg-white/40 text-white grid place-items-center">
    ‹
  </button>
  <button id="hero-next"
    class="hero-controls pointer-events-auto z-30 absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 hover:bg-white/40 text-white grid place-items-center">
    ›
  </button>

  <!-- Indicadores -->
  <div class="hero-dots z-30 absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-3">
    {slides.map((_, i) => (
      <button
        class={`hero-indicator h-2 w-8 rounded-full transition
                ${i === 0 ? "bg-orange-500" : "bg-white/50 hover:bg-white"}`}
        data-goto={i}
        aria-label={`Ir al slide ${i + 1}`}
        aria-selected={i === 0 ? "true" : "false"}
      />
    ))}
  </div>
</section>

<style>
  /* Slides invisibles no interceptan clics */
  .hero-slide { opacity: 0; pointer-events: none; z-index: 10; }
  .hero-slide.is-active { opacity: 1; pointer-events: auto; }

  /* Fondo no intercepta clics */
  .hero-image, .hero-backdrop { pointer-events: none; }

  /* Controles e indicadores por encima */
  .hero-controls, .hero-dots { z-index: 50; }
</style>

<!-- LÓGICA DEL CARRUSEL (JS puro; sin TS; una sola vez) -->
<script type="module">
  function initHeroCarousel(root = document) {
    const slides = Array.from(root.querySelectorAll(".hero-slide"));
    const dots = Array.from(root.querySelectorAll(".hero-indicator"));
    const prev = root.querySelector("#hero-prev");
    const next = root.querySelector("#hero-next");
    const hero = root.getElementById ? root.getElementById("hero") : document.getElementById("hero");

    if (!slides.length || !prev || !next || !hero) return;
    if (hero.dataset.bound === "1") return; // evita doble init (SSR + SPA)
    hero.dataset.bound = "1";

    let i = 0;
    const paint = () => {
      slides.forEach((el, idx) => el.classList.toggle("is-active", idx === i));
      dots.forEach((el, idx) => {
        el.classList.toggle("bg-orange-500", idx === i);
        el.classList.toggle("bg-white/50", idx !== i);
        el.setAttribute("aria-selected", idx === i ? "true" : "false");
      });
    };
    const go = (n) => { i = (n + slides.length) % slides.length; paint(); };
    const nextFn = () => go(i + 1);
    const prevFn = () => go(i - 1);

    next.addEventListener("click", nextFn);
    prev.addEventListener("click", prevFn);
    dots.forEach((btn, idx) => btn.addEventListener("click", () => go(idx)));

    paint();
  }

  // Inicial y en navegaciones SPA de Astro
  initHeroCarousel(document);
  window.addEventListener("astro:page-load", () => initHeroCarousel(document));
</script>
